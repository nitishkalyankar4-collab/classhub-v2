<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClassHub V2 - Classroom Communication & AI Learning Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-blue: #2563eb;
            --primary-green: #10b981;
            --primary-purple: #8b5cf6;
            --neutral-dark: #1f2937;
            --neutral-gray: #6b7280;
            --neutral-light: #f3f4f6;
            --neutral-white: #ffffff;
            --error-red: #ef4444;
            --warning-orange: #f97316;
            --success-green: #22c55e;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background-color: var(--neutral-light);
            color: var(--neutral-dark);
            height: 100%;
            overflow: hidden;
        }

        #app {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ===== AUTHENTICATION SCREENS ===== */
        .auth-container {
            display: flex;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-purple) 100%);
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .auth-card {
            background: var(--neutral-white);
            border-radius: 12px;
            padding: 40px;
            width: 100%;
            max-width: 420px;
            box-shadow: var(--shadow-lg);
        }

        .auth-card h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--neutral-dark);
        }

        .auth-card p {
            color: var(--neutral-gray);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--neutral-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .role-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .role-option {
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            background: var(--neutral-white);
        }

        .role-option:hover {
            border-color: var(--primary-blue);
        }

        .role-option.selected {
            background-color: rgba(37, 99, 235, 0.1);
            border-color: var(--primary-blue);
        }

        .role-option .icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .role-option .label {
            font-size: 13px;
            font-weight: 500;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-blue);
            color: var(--neutral-white);
            width: 100%;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:disabled {
            background-color: var(--neutral-gray);
            cursor: not-allowed;
        }

        .btn-secondary {
            background-color: var(--neutral-light);
            color: var(--neutral-dark);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--neutral-white);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
        }

        .btn-danger {
            background-color: var(--error-red);
            color: var(--neutral-white);
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-success {
            background-color: var(--success-green);
            color: var(--neutral-white);
        }

        .btn-success:hover {
            background-color: #16a34a;
        }

        .auth-footer {
            margin-top: 20px;
            text-align: center;
            color: var(--neutral-gray);
            font-size: 14px;
        }

        .auth-footer a {
            color: var(--primary-blue);
            cursor: pointer;
            text-decoration: none;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* ===== MAIN LAYOUT ===== */
        .main-layout {
            display: flex;
            width: 100%;
            height: 100vh;
        }

        .sidebar {
            width: 280px;
            background-color: var(--neutral-white);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-sm);
            z-index: 100;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-header .logo {
            font-size: 28px;
        }

        .sidebar-header .title {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-blue);
        }

        .sidebar-header .subtitle {
            font-size: 11px;
            color: var(--neutral-gray);
        }

        .sidebar-nav {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 20px;
        }

        .nav-section-title {
            padding: 0 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--neutral-gray);
            margin-bottom: 10px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--neutral-gray);
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            margin: 0 10px;
            border-radius: 0 8px 8px 0;
        }

        .nav-item:hover {
            background-color: var(--neutral-light);
            color: var(--primary-blue);
        }

        .nav-item.active {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary-blue);
            border-left-color: var(--primary-blue);
            font-weight: 600;
        }

        .nav-item .icon {
            font-size: 18px;
            min-width: 20px;
        }

        .nav-item .label {
            flex: 1;
            font-size: 14px;
        }

        .nav-item .badge {
            background-color: var(--error-red);
            color: var(--neutral-white);
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 11px;
            font-weight: 600;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .user-profile-mini {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background-color: var(--neutral-light);
            border-radius: 8px;
        }

        .user-profile-mini .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-white);
            font-weight: 700;
            font-size: 16px;
        }

        .user-profile-mini .info {
            flex: 1;
        }

        .user-profile-mini .name {
            font-size: 13px;
            font-weight: 600;
            color: var(--neutral-dark);
        }

        .user-profile-mini .email {
            font-size: 11px;
            color: var(--neutral-gray);
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: var(--neutral-light);
        }

        .top-bar {
            background-color: var(--neutral-white);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-sm);
        }

        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
        }

        .page-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--neutral-dark);
        }

        .breadcrumb {
            font-size: 13px;
            color: var(--neutral-gray);
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .breadcrumb span {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .search-box {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: var(--neutral-light);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 12px;
            flex: 0 1 300px;
        }

        .search-box input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 14px;
            outline: none;
        }

        .search-box input::placeholder {
            color: var(--neutral-gray);
        }

        .icon-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            color: var(--neutral-gray);
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .icon-button:hover {
            background-color: var(--neutral-light);
            color: var(--primary-blue);
        }

        .icon-button.has-notification {
            position: relative;
        }

        .icon-button.has-notification::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 8px;
            height: 8px;
            background-color: var(--error-red);
            border-radius: 50%;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background-color: var(--neutral-white);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            min-width: 250px;
            z-index: 1000;
            margin-top: 8px;
        }

        .dropdown-menu.hidden {
            display: none;
        }

        .dropdown-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            font-size: 13px;
            color: var(--neutral-dark);
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
            color: var(--neutral-dark);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dropdown-item:hover {
            background-color: var(--neutral-light);
        }

        .dropdown-divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 4px 0;
        }

        /* ===== CONTENT AREA ===== */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        /* ===== CARDS & COMPONENTS ===== */
        .card {
            background-color: var(--neutral-white);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 20px;
        }

        .card-header {
            font-size: 18px;
            font-weight: 700;
            color: var(--neutral-dark);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card-item {
            background-color: var(--neutral-white);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }

        .card-item:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .card-item-image {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-white);
            font-size: 48px;
        }

        .card-item-body {
            padding: 16px;
        }

        .card-item-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--neutral-dark);
            margin-bottom: 8px;
        }

        .card-item-subtitle {
            font-size: 13px;
            color: var(--neutral-gray);
            margin-bottom: 12px;
        }

        .card-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--neutral-gray);
        }

        /* ===== MODALS & DIALOGS ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal-dialog {
            background-color: var(--neutral-white);
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 700;
            color: var(--neutral-dark);
        }

        .modal-header .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--neutral-gray);
            transition: color 0.3s;
        }

        .modal-header .close-btn:hover {
            color: var(--neutral-dark);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* ===== TABS ===== */
        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--neutral-gray);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            margin-bottom: -2px;
        }

        .tab:hover {
            color: var(--primary-blue);
        }

        .tab.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== MESSAGES & CHAT ===== */
        .message-thread {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 20px;
        }

        .message {
            display: flex;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            background-color: var(--neutral-light);
        }

        .message.own {
            background-color: rgba(37, 99, 235, 0.1);
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-white);
            font-weight: 700;
            font-size: 14px;
            flex-shrink: 0;
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .message-name {
            font-weight: 600;
            color: var(--neutral-dark);
            font-size: 13px;
        }

        .message-time {
            font-size: 11px;
            color: var(--neutral-gray);
        }

        .message-text {
            font-size: 14px;
            color: var(--neutral-dark);
            word-wrap: break-word;
        }

        .chat-input-area {
            display: flex;
            gap: 12px;
            padding: 16px;
            background-color: var(--neutral-white);
            border-top: 1px solid var(--border-color);
            border-radius: 0 0 12px 12px;
        }

        .chat-input {
            flex: 1;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            font-family: inherit;
            resize: none;
            max-height: 100px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* ===== TABLE ===== */
        .table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--neutral-white);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .table thead {
            background-color: var(--neutral-light);
        }

        .table th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--neutral-dark);
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
        }

        .table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
            color: var(--neutral-dark);
        }

        .table tbody tr:hover {
            background-color: var(--neutral-light);
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        /* ===== FORMS ===== */
        .form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        .textarea-group textarea {
            min-height: 120px;
        }

        /* ===== PROGRESS & STATUS ===== */
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--success-green);
            transition: width 0.3s;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }

        .badge-primary {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary-blue);
        }

        .badge-success {
            background-color: rgba(34, 197, 94, 0.1);
            color: var(--success-green);
        }

        .badge-warning {
            background-color: rgba(249, 115, 22, 0.1);
            color: var(--warning-orange);
        }

        .badge-danger {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--error-red);
        }

        /* ===== NOTIFICATIONS ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--neutral-white);
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--primary-blue);
            border-radius: 8px;
            padding: 16px;
            box-shadow: var(--shadow-lg);
            z-index: 3000;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-left-color: var(--success-green);
        }

        .notification.error {
            border-left-color: var(--error-red);
        }

        .notification.warning {
            border-left-color: var(--warning-orange);
        }

        .notification-title {
            font-weight: 600;
            color: var(--neutral-dark);
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 13px;
            color: var(--neutral-gray);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }

            .card-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                max-height: 60px;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                flex-direction: row;
                align-items: center;
                overflow: hidden;
            }

            .sidebar-header {
                flex: 1;
                padding: 12px 16px;
                border-bottom: none;
                border-right: 1px solid var(--border-color);
            }

            .sidebar-nav {
                display: none;
                position: absolute;
                top: 60px;
                left: 0;
                right: 0;
                background-color: var(--neutral-white);
                flex-direction: column;
                border-top: 1px solid var(--border-color);
                border-bottom: 1px solid var(--border-color);
                max-height: calc(100vh - 60px);
                overflow-y: auto;
                z-index: 99;
            }

            .sidebar-nav.active {
                display: flex;
            }

            .sidebar-footer {
                display: none;
            }

            .content-area {
                padding: 16px;
            }

            .search-box {
                flex: 0 1 200px;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            .top-bar {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .top-bar-right {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--neutral-gray);
        }

        .empty-state .icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--neutral-dark);
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 14px;
            margin-bottom: 24px;
        }

        /* ===== LOADING ===== */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .skeleton {
            background: linear-gradient(90deg, var(--neutral-light) 25%, var(--neutral-white) 50%, var(--neutral-light) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ===== UTILS ===== */
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }
        .p-20 { padding: 20px; }
        .text-center { text-align: center; }
        .flex { display: flex; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .gap-10 { gap: 10px; }
        .gap-20 { gap: 20px; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .hidden { display: none; }
        .visible { display: block; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ===== STATE MANAGEMENT =====
        class AppState {
            constructor() {
                this.currentUser = null;
                this.currentScreen = 'login';
                this.classrooms = [];
                this.students = [];
                this.teachers = [];
                this.assignments = [];
                this.messages = [];
                this.grades = [];
                this.notifications = [];
                this.chatHistory = [];
                this.userProfiles = {};
                this.parentAccess = [];
                this.load();
            }

            setCurrentUser(user) {
                this.currentUser = user;
                this.save();
            }

            setCurrentScreen(screen) {
                this.currentScreen = screen;
            }

            save() {
                const state = {
                    currentUser: this.currentUser,
                    classrooms: this.classrooms,
                    students: this.students,
                    teachers: this.teachers,
                    assignments: this.assignments,
                    messages: this.messages,
                    grades: this.grades,
                    chatHistory: this.chatHistory,
                    userProfiles: this.userProfiles,
                    parentAccess: this.parentAccess,
                };
                localStorage.setItem('appState', JSON.stringify(state));
            }

            load() {
                const saved = localStorage.getItem('appState');
                if (saved) {
                    const state = JSON.parse(saved);
                    Object.assign(this, state);
                }
            }

            clear() {
                localStorage.removeItem('appState');
                this.currentUser = null;
                this.classrooms = [];
                this.students = [];
                this.teachers = [];
                this.assignments = [];
                this.messages = [];
                this.grades = [];
                this.notifications = [];
                this.chatHistory = [];
                this.userProfiles = {};
                this.parentAccess = [];
            }
        }

        const appState = new AppState();

        // ===== UTILITY FUNCTIONS =====
        const utils = {
            generateId: () => Math.random().toString(36).substr(2, 9),
            generateCode: () => Math.random().toString(36).substr(2, 6).toUpperCase(),
            formatDate: (date) => {
                const d = new Date(date);
                return d.toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' });
            },
            formatTime: (date) => {
                const d = new Date(date);
                return d.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
            },
            formatDateTime: (date) => {
                return `${utils.formatDate(date)} ${utils.formatTime(date)}`;
            },
            getInitials: (name) => {
                return name
                    .split(' ')
                    .map(n => n[0])
                    .join('')
                    .toUpperCase()
                    .slice(0, 2);
            },
            getRandomGradient: () => {
                const colors = [
                    '#2563eb, #8b5cf6',
                    '#10b981, #059669',
                    '#f59e0b, #f97316',
                    '#ef4444, #dc2626',
                    '#6366f1, #a855f7',
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            },
            getCurrentDateTime: () => new Date().toISOString(),
        };

        // ===== UI COMPONENTS =====
        const ui = {
            showNotification: (message, type = 'success', duration = 3000) => {
                const id = utils.generateId();
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div class="notification-message">${message}</div>
                `;
                document.body.appendChild(notification);
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease-out forwards';
                    setTimeout(() => notification.remove(), 300);
                }, duration);
            },

            showModal: (title, content, buttons = []) => {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                let buttonsHtml = '';
                buttons.forEach(btn => {
                    buttonsHtml += `<button class="btn ${btn.className || 'btn-secondary'}" data-action="${btn.action}">${btn.text}</button>`;
                });
                modal.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <h2>${title}</h2>
                            <button class="close-btn">&times;</button>
                        </div>
                        <div class="modal-body">${content}</div>
                        <div class="modal-footer">${buttonsHtml}</div>
                    </div>
                `;
                document.body.appendChild(modal);
                modal.querySelector('.close-btn').addEventListener('click', () => modal.remove());
                modal.querySelectorAll('button[data-action]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const action = btn.getAttribute('data-action');
                        btn.dispatchEvent(new CustomEvent('action', { detail: action }));
                        modal.remove();
                    });
                });
                return modal;
            },
        };

        // ===== SCREENS =====
        const screens = {
            login: () => {
                let selectedRole = null;
                return `
                    <div class="auth-container">
                        <div class="auth-card">
                            <h1>Welcome to ClassHub</h1>
                            <p>Select your role to continue</p>
                            <div class="role-selector">
                                <div class="role-option" data-role="admin">
                                    <div class="icon">üë®‚Äçüíº</div>
                                    <div class="label">Admin</div>
                                </div>
                                <div class="role-option" data-role="teacher">
                                    <div class="icon">üë®‚Äçüè´</div>
                                    <div class="label">Teacher</div>
                                </div>
                                <div class="role-option" data-role="student">
                                    <div class="icon">üë®‚Äçüéì</div>
                                    <div class="label">Student</div>
                                </div>
                                <div class="role-option" data-role="parent">
                                    <div class="icon">üë®‚Äçüë©‚Äçüëß</div>
                                    <div class="label">Parent</div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" id="email" placeholder="Enter your email">
                            </div>
                            <div class="form-group">
                                <label>Password (or OTP will be sent)</label>
                                <input type="password" id="password" placeholder="Enter password">
                            </div>
                            <button class="btn btn-primary" onclick="handleLogin()">Login</button>
                            <div class="auth-footer">
                                Don't have an account? <a onclick="appState.setCurrentScreen('signup'); renderApp()">Sign Up</a>
                            </div>
                        </div>
                    </div>
                `;
            },

            signup: () => {
                return `
                    <div class="auth-container">
                        <div class="auth-card">
                            <h1>Create Account</h1>
                            <p>Join ClassHub to get started</p>
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" id="fullName" placeholder="Enter your full name">
                            </div>
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" id="signupEmail" placeholder="Enter your email">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="signupPassword" placeholder="Create a strong password">
                            </div>
                            <div class="form-group">
                                <label>Role</label>
                                <select id="signupRole">
                                    <option value="">Select your role</option>
                                    <option value="admin">School Admin</option>
                                    <option value="teacher">Teacher</option>
                                    <option value="student">Student</option>
                                    <option value="parent">Parent</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="handleSignup()">Create Account</button>
                            <div class="auth-footer">
                                Already have an account? <a onclick="appState.setCurrentScreen('login'); renderApp()">Login</a>
                            </div>
                        </div>
                    </div>
                `;
            },

            dashboard: () => {
                const user = appState.currentUser;
                if (!user) return screens.login();

                if (user.role === 'admin') return screens.adminDashboard();
                if (user.role === 'teacher') return screens.teacherDashboard();
                if (user.role === 'student') return screens.studentDashboard();
                if (user.role === 'parent') return screens.parentDashboard();
            },

            adminDashboard: () => {
                const schoolStats = {
                    totalTeachers: appState.teachers.length,
                    totalStudents: appState.students.length,
                    totalClassrooms: appState.classrooms.length,
                    totalAssignments: appState.assignments.length,
                };

                return `
                    <div class="card">
                        <div class="card-header">
                            <div>Welcome, ${appState.currentUser.name} üëã</div>
                            <button class="btn btn-secondary btn-sm" onclick="openModal('addTeacher')">+ Add Teacher</button>
                        </div>
                    </div>

                    <div class="card-grid">
                        <div class="card-item">
                            <div class="card-item-image">üìö</div>
                            <div class="card-item-body">
                                <div class="card-item-title">${schoolStats.totalClassrooms}</div>
                                <div class="card-item-subtitle">Total Classrooms</div>
                            </div>
                        </div>
                        <div class="card-item">
                            <div class="card-item-image">üë®‚Äçüè´</div>
                            <div class="card-item-body">
                                <div class="card-item-title">${schoolStats.totalTeachers}</div>
                                <div class="card-item-subtitle">Total Teachers</div>
                            </div>
                        </div>
                        <div class="card-item">
                            <div class="card-item-image">üë®‚Äçüéì</div>
                            <div class="card-item-body">
                                <div class="card-item-title">${schoolStats.totalStudents}</div>
                                <div class="card-item-subtitle">Total Students</div>
                            </div>
                        </div>
                        <div class="card-item">
                            <div class="card-item-image">‚úèÔ∏è</div>
                            <div class="card-item-body">
                                <div class="card-item-title">${schoolStats.totalAssignments}</div>
                                <div class="card-item-subtitle">Total Assignments</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">Teachers Management</div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Classrooms</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${appState.teachers.map(teacher => `
                                    <tr>
                                        <td>${teacher.name}</td>
                                        <td>${teacher.email}</td>
                                        <td>${appState.classrooms.filter(c => c.teacherId === teacher.id).length}</td>
                                        <td>
                                            <button class="btn btn-sm btn-danger" onclick="removeTeacher('${teacher.id}')">Remove</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            },

            teacherDashboard: () => {
                const myClassrooms = appState.classrooms.filter(c => c.teacherId === appState.currentUser.id);
                return `
                    <div class="card">
                        <div class="card-header">
                            <div>My Classes</div>
                            <button class="btn btn-primary btn-sm" onclick="openModal('createClassroom')">+ Create Class</button>
                        </div>
                    </div>

                    <div class="card-grid">
                        ${myClassrooms.map(classroom => `
                            <div class="card-item" onclick="selectClassroom('${classroom.id}')">
                                <div class="card-item-image">üìö</div>
                                <div class="card-item-body">
                                    <div class="card-item-title">${classroom.name}</div>
                                    <div class="card-item-subtitle">${classroom.subject} - ${classroom.section}</div>
                                    <div class="card-item-subtitle">Join Code: <strong>${classroom.joinCode}</strong></div>
                                    <div class="card-item-footer">
                                        <span>${appState.students.filter(s => s.classroomId === classroom.id).length} Students</span>
                                        <span>${appState.assignments.filter(a => a.classroomId === classroom.id).length} Assignments</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    ${myClassrooms.length > 0 ? `
                        <div class="card">
                            <div class="card-header">Recent Assignments</div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Assignment</th>
                                        <th>Class</th>
                                        <th>Due Date</th>
                                        <th>Submissions</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${appState.assignments.filter(a => a.teacherId === appState.currentUser.id).slice(0, 5).map(assignment => `
                                        <tr>
                                            <td>${assignment.title}</td>
                                            <td>${appState.classrooms.find(c => c.id === assignment.classroomId)?.name}</td>
                                            <td>${utils.formatDate(assignment.dueDate)}</td>
                                            <td>${appState.students.filter(s => s.submittedAssignments?.includes(assignment.id)).length}</td>
                                            <td><button class="btn btn-sm btn-secondary" onclick="viewAssignment('${assignment.id}')">View</button></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : ''}
                `;
            },

            studentDashboard: () => {
                const myClassrooms = appState.classrooms.filter(c => c.students?.includes(appState.currentUser.id));
                const myAssignments = appState.assignments.filter(a => myClassrooms.some(c => c.id === a.classroomId));

                return `
                    <div class="card">
                        <div class="card-header">
                            <div>My Classrooms</div>
                            <button class="btn btn-primary btn-sm" onclick="openModal('joinClassroom')">+ Join Class</button>
                        </div>
                    </div>

                    <div class="card-grid">
                        ${myClassrooms.map(classroom => `
                            <div class="card-item" onclick="selectClassroom('${classroom.id}')">
                                <div class="card-item-image">üìö</div>
                                <div class="card-item-body">
                                    <div class="card-item-title">${classroom.name}</div>
                                    <div class="card-item-subtitle">${classroom.subject}</div>
                                    <div class="card-item-footer">
                                        <span>${appState.assignments.filter(a => a.classroomId === classroom.id && !appState.students.find(s => s.id === appState.currentUser.id)?.submittedAssignments?.includes(a.id)).length} Pending</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="card">
                        <div class="card-header">Pending Assignments</div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Assignment</th>
                                    <th>Class</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${myAssignments.map(assignment => {
                                    const submitted = appState.currentUser.submittedAssignments?.includes(assignment.id);
                                    return `
                                        <tr>
                                            <td>${assignment.title}</td>
                                            <td>${appState.classrooms.find(c => c.id === assignment.classroomId)?.name}</td>
                                            <td>${utils.formatDate(assignment.dueDate)}</td>
                                            <td><span class="badge ${submitted ? 'badge-success' : 'badge-warning'}">${submitted ? 'Submitted' : 'Pending'}</span></td>
                                            <td><button class="btn btn-sm btn-secondary" onclick="viewAssignmentStudent('${assignment.id}')">View</button></td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            },

            parentDashboard: () => {
                const childAssignments = appState.assignments.filter(a => {
                    const classroom = appState.classrooms.find(c => c.id === a.classroomId);
                    return appState.currentUser.childId && classroom?.students?.includes(appState.currentUser.childId);
                });

                return `
                    <div class="card">
                        <div class="card-header">
                            <div>Child's Academic Progress</div>
                        </div>
                    </div>

                    ${appState.currentUser.childId ? `
                        <div class="card">
                            <div class="card-header">Performance Summary</div>
                            <div class="p-20">
                                <p><strong>Average Grade:</strong> ${(Math.random() * 100).toFixed(1)}%</p>
                                <p><strong>Attendance:</strong> 92%</p>
                                <p><strong>Last Updated:</strong> ${utils.formatDate(new Date())}</p>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">Upcoming Assignments</div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Assignment</th>
                                        <th>Due Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${childAssignments.slice(0, 5).map(assignment => `
                                        <tr>
                                            <td>${assignment.title}</td>
                                            <td>${utils.formatDate(assignment.dueDate)}</td>
                                            <td><span class="badge badge-warning">Pending</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : `
                        <div class="empty-state">
                            <div class="icon">üë®‚Äçüë©‚Äçüëß</div>
                            <h3>Link Your Child's Account</h3>
                            <p>Request access to your child's ClassHub profile</p>
                            <button class="btn btn-primary" onclick="openModal('linkChild')">Request Access</button>
                        </div>
                    `}
                `;
            },

            classroom: (classroomId) => {
                const classroom = appState.classrooms.find(c => c.id === classroomId);
                if (!classroom) return '<div class="empty-state">Classroom not found</div>';

                const tabs = `
                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('feed')">Feed</button>
                        <button class="tab" onclick="switchTab('assignments')">Assignments</button>
                        <button class="tab" onclick="switchTab('notes')">Notes</button>
                        <button class="tab" onclick="switchTab('members')">Members</button>
                        <button class="tab" onclick="switchTab('chat')">Chat</button>
                        <button class="tab" onclick="switchTab('grades')">Grades</button>
                    </div>
                `;

                return tabs + `
                    <div id="feed" class="tab-content active">
                        <div class="card">
                            <div class="card-header">
                                <div>${classroom.name}</div>
                                ${appState.currentUser.role === 'teacher' ? `<button class="btn btn-secondary btn-sm" onclick="openModal('broadcastAlert')">üì¢ Alert</button>` : ''}
                            </div>
                            <div class="message-thread">
                                ${classroom.announcements?.map(ann => `
                                    <div class="message">
                                        <div class="message-avatar">üì¢</div>
                                        <div class="message-content">
                                            <div class="message-header">
                                                <span class="message-name">Classroom Alert</span>
                                                <span class="message-time">${utils.formatTime(ann.timestamp)}</span>
                                            </div>
                                            <div class="message-text">${ann.text}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <div id="assignments" class="tab-content">
                        <div class="card">
                            <div class="card-header">
                                <div>Assignments</div>
                                ${appState.currentUser.role === 'teacher' ? `<button class="btn btn-primary btn-sm" onclick="openModal('createAssignment', '${classroomId}')">+ Create</button>` : ''}
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Due Date</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${appState.assignments.filter(a => a.classroomId === classroomId).map(a => `
                                        <tr>
                                            <td>${a.title}</td>
                                            <td>${utils.formatDate(a.dueDate)}</td>
                                            <td><span class="badge badge-primary">Active</span></td>
                                            <td><button class="btn btn-sm btn-secondary" onclick="viewAssignmentDetail('${a.id}')">View</button></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="notes" class="tab-content">
                        <div class="card">
                            <div class="card-header">
                                <div>Study Materials</div>
                                ${appState.currentUser.role === 'teacher' ? `<button class="btn btn-primary btn-sm" onclick="openModal('uploadNotes', '${classroomId}')">+ Upload</button>` : ''}
                            </div>
                            ${classroom.notes?.map(note => `
                                <div class="card mb-20">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <h4>${note.title}</h4>
                                            <p style="color: var(--neutral-gray); font-size: 13px;">${note.description}</p>
                                            <p style="color: var(--neutral-gray); font-size: 12px;">Uploaded: ${utils.formatDate(note.uploadedAt)}</p>
                                        </div>
                                        <button class="btn btn-secondary btn-sm">‚¨áÔ∏è Download</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div id="members" class="tab-content">
                        <div class="card">
                            <div class="card-header">
                                <div>Class Members (${appState.students.filter(s => s.classroomId === classroomId).length})</div>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Roll Number</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${appState.students.filter(s => s.classroomId === classroomId).map(student => `
                                        <tr>
                                            <td>${student.name}</td>
                                            <td>${student.email}</td>
                                            <td>${student.rollNumber || 'N/A'}</td>
                                            <td><span class="badge badge-success">Active</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="chat" class="tab-content">
                        <div class="card">
                            <div class="card-header">Class Discussion</div>
                            <div class="message-thread">
                                ${classroom.messages?.map(msg => `
                                    <div class="message">
                                        <div class="message-avatar">${utils.getInitials(msg.senderName)}</div>
                                        <div class="message-content">
                                            <div class="message-header">
                                                <span class="message-name">${msg.senderName}</span>
                                                <span class="message-time">${utils.formatTime(msg.timestamp)}</span>
                                            </div>
                                            <div class="message-text">${msg.text}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="chat-input-area">
                                <input type="text" class="chat-input" id="chatInput" placeholder="Type a message...">
                                <button class="btn btn-primary btn-sm" onclick="sendMessage('${classroomId}')">Send</button>
                            </div>
                        </div>
                    </div>

                    <div id="grades" class="tab-content">
                        <div class="card">
                            <div class="card-header">Grades & Performance</div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Assignment</th>
                                        <th>Grade</th>
                                        <th>Feedback</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${appState.grades.filter(g => g.classroomId === classroomId && g.studentId === appState.currentUser.id).map(g => `
                                        <tr>
                                            <td>${appState.assignments.find(a => a.id === g.assignmentId)?.title}</td>
                                            <td><strong>${g.score}/100</strong></td>
                                            <td>${g.feedback || 'No feedback yet'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            },

            aiChatbot: () => {
                const isStudent = appState.currentUser.role === 'student';
                return `
                    <div class="card">
                        <div class="card-header">
                            <div>ü§ñ Smart Tutor - AI Learning Assistant</div>
                        </div>
                        <div style="height: 400px; overflow-y: auto; padding: 20px; background-color: var(--neutral-light); border-radius: 8px; margin-bottom: 16px;">
                            <div class="message-thread">
                                ${appState.chatHistory.map((chat, i) => `
                                    <div class="message ${chat.role === 'user' ? 'own' : ''}">
                                        <div class="message-avatar">${chat.role === 'user' ? utils.getInitials(appState.currentUser.name) : 'ü§ñ'}</div>
                                        <div class="message-content">
                                            <div class="message-header">
                                                <span class="message-name">${chat.role === 'user' ? 'You' : 'Smart Tutor'}</span>
                                                <span class="message-time">${utils.formatTime(chat.timestamp)}</span>
                                            </div>
                                            <div class="message-text">${chat.message}</div>
                                        </div>
                                    </div>
                                `).join('')}
                                ${appState.chatHistory.length === 0 ? `
                                    <div class="empty-state">
                                        <div class="icon">ü§ñ</div>
                                        <h3>Welcome to Smart Tutor</h3>
                                        <p>Ask me any academic question and I'll help you understand the concept step by step.</p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        <div class="chat-input-area">
                            <input type="text" class="chat-input" id="aiChatInput" placeholder="Ask any academic question...">
                            <button class="btn btn-primary btn-sm" onclick="sendAIMessage()">Send</button>
                        </div>
                    </div>
                `;
            },

            studentProfile: () => {
                const user = appState.currentUser;
                const userProfile = appState.userProfiles[user.id] || {};
                
                return `
                    <div class="card">
                        <div class="card-header">
                            Student Profile
                        </div>
                        <form class="form" id="profileForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Full Name</label>
                                    <input type="text" value="${user.name}" id="profileName">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" value="${user.email}" id="profileEmail">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Roll Number</label>
                                    <input type="text" value="${userProfile.rollNumber || ''}" id="profileRoll">
                                </div>
                                <div class="form-group">
                                    <label>Grade/Section</label>
                                    <input type="text" value="${userProfile.section || ''}" id="profileSection">
                                </div>
                            </div>
                            <div class="form-row full">
                                <div class="form-group">
                                    <label>Bio</label>
                                    <textarea id="profileBio">${userProfile.bio || ''}</textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <input type="tel" value="${userProfile.phone || ''}" id="profilePhone">
                                </div>
                                <div class="form-group">
                                    <label>Date of Birth</label>
                                    <input type="date" value="${userProfile.dob || ''}" id="profileDob">
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="saveStudentProfile()">Save Profile</button>
                        </form>
                    </div>
                `;
            },

            teacherProfile: () => {
                const user = appState.currentUser;
                const userProfile = appState.userProfiles[user.id] || {};
                
                return `
                    <div class="card">
                        <div class="card-header">
                            Teacher Profile
                        </div>
                        <form class="form" id="profileForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Full Name</label>
                                    <input type="text" value="${user.name}" id="profileName">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" value="${user.email}" id="profileEmail">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Qualification</label>
                                    <input type="text" value="${userProfile.qualification || ''}" id="profileQual">
                                </div>
                                <div class="form-group">
                                    <label>Subject Specialization</label>
                                    <input type="text" value="${userProfile.subject || ''}" id="profileSubject">
                                </div>
                            </div>
                            <div class="form-row full">
                                <div class="form-group">
                                    <label>Bio</label>
                                    <textarea id="profileBio">${userProfile.bio || ''}</textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <input type="tel" value="${userProfile.phone || ''}" id="profilePhone">
                                </div>
                                <div class="form-group">
                                    <label>Years of Experience</label>
                                    <input type="number" value="${userProfile.experience || ''}" id="profileExp">
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="saveTeacherProfile()">Save Profile</button>
                        </form>
                    </div>
                `;
            },

            parentProfile: () => {
                const user = appState.currentUser;
                const userProfile = appState.userProfiles[user.id] || {};
                
                return `
                    <div class="card">
                        <div class="card-header">
                            Parent/Guardian Profile
                        </div>
                        <form class="form" id="profileForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Full Name</label>
                                    <input type="text" value="${user.name}" id="profileName">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" value="${user.email}" id="profileEmail">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Relationship to Child</label>
                                    <select id="profileRelation">
                                        <option value="parent" ${userProfile.relationship === 'parent' ? 'selected' : ''}>Parent</option>
                                        <option value="guardian" ${userProfile.relationship === 'guardian' ? 'selected' : ''}>Guardian</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <input type="tel" value="${userProfile.phone || ''}" id="profilePhone">
                                </div>
                            </div>
                            <div class="form-row full">
                                <div class="form-group">
                                    <label>Child's Name (for linking)</label>
                                    <input type="text" value="${userProfile.childName || ''}" id="profileChildName">
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="saveParentProfile()">Save Profile</button>
                        </form>
                    </div>
                `;
            },

            adminProfile: () => {
                const user = appState.currentUser;
                const userProfile = appState.userProfiles[user.id] || {};
                
                return `
                    <div class="card">
                        <div class="card-header">
                            Administrator Profile
                        </div>
                        <form class="form" id="profileForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Full Name</label>
                                    <input type="text" value="${user.name}" id="profileName">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" value="${user.email}" id="profileEmail">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>School Name</label>
                                    <input type="text" value="${userProfile.schoolName || ''}" id="profileSchool">
                                </div>
                                <div class="form-group">
                                    <label>Phone Number</label>
                                    <input type="tel" value="${userProfile.phone || ''}" id="profilePhone">
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="saveAdminProfile()">Save Profile</button>
                        </form>
                    </div>
                `;
            },

            settings: () => {
                return `
                    <div class="card">
                        <div class="card-header">Settings & Preferences</div>
                        <div class="form">
                            <h3>Notifications</h3>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Email Notifications
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Push Notifications
                                </label>
                            </div>

                            <h3 style="margin-top: 30px;">Privacy</h3>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked> Allow teachers to view my profile
                                </label>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox"> Share performance data with parents
                                </label>
                            </div>

                            <h3 style="margin-top: 30px;">Display</h3>
                            <div class="form-group">
                                <label>Theme</label>
                                <select>
                                    <option>Light</option>
                                    <option>Dark</option>
                                    <option>System</option>
                                </select>
                            </div>

                            <h3 style="margin-top: 30px;">Account</h3>
                            <button class="btn btn-secondary" onclick="changePassword()">Change Password</button>
                            <button class="btn btn-danger" onclick="logout()" style="margin-left: 10px;">Logout</button>
                        </div>
                    </div>
                `;
            },
        };

        // ===== HANDLER FUNCTIONS =====
        function handleLogin() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            const roleOptions = document.querySelectorAll('.role-option');
            let selectedRole = null;

            roleOptions.forEach(opt => {
                if (opt.classList.contains('selected')) {
                    selectedRole = opt.getAttribute('data-role');
                }
            });

            if (!email || !password || !selectedRole) {
                ui.showNotification('Please fill all fields and select a role', 'error');
                return;
            }

            const user = {
                id: utils.generateId(),
                email,
                password,
                role: selectedRole,
                name: email.split('@')[0],
                submittedAssignments: [],
            };

            appState.setCurrentUser(user);
            appState.setCurrentScreen('dashboard');
            renderApp();
            ui.showNotification(`Welcome, ${user.name}!`, 'success');
        }

        function handleSignup() {
            const fullName = document.getElementById('fullName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value.trim();
            const role = document.getElementById('signupRole').value;

            if (!fullName || !email || !password || !role) {
                ui.showNotification('Please fill all fields', 'error');
                return;
            }

            const user = {
                id: utils.generateId(),
                email,
                password,
                name: fullName,
                role,
                submittedAssignments: [],
            };

            if (role === 'teacher') {
                appState.teachers.push(user);
            } else if (role === 'student') {
                appState.students.push(user);
            }

            appState.setCurrentUser(user);
            appState.save();
            appState.setCurrentScreen('dashboard');
            renderApp();
            ui.showNotification('Account created successfully!', 'success');
        }

        function selectClassroom(classroomId) {
            sessionStorage.setItem('selectedClassroom', classroomId);
            appState.setCurrentScreen('classroom');
            renderApp();
        }

        function sendMessage(classroomId) {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            const classroom = appState.classrooms.find(c => c.id === classroomId);
            if (classroom) {
                if (!classroom.messages) classroom.messages = [];
                classroom.messages.push({
                    senderName: appState.currentUser.name,
                    text: message,
                    timestamp: utils.getCurrentDateTime(),
                });
                appState.save();
                input.value = '';
                renderApp();
            }
        }

        function sendAIMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            if (!message) return;

            appState.chatHistory.push({
                role: 'user',
                message,
                timestamp: utils.getCurrentDateTime(),
            });

            const aiResponses = [
                'Great question! Let me break this down for you step by step. First, understand the fundamentals...',
                'That\'s an excellent concept to explore. Here\'s a clear explanation with examples...',
                'I can help you with that! Let me provide you with the key concepts and a worked example...',
                'This is a common question in the curriculum. Here\'s what you need to know...',
                'Perfect timing to ask this! Let me walk you through the solution systematically...',
            ];

            setTimeout(() => {
                appState.chatHistory.push({
                    role: 'assistant',
                    message: aiResponses[Math.floor(Math.random() * aiResponses.length)],
                    timestamp: utils.getCurrentDateTime(),
                });
                appState.save();
                input.value = '';
                renderApp();
            }, 1000);
        }

        function openModal(type, classroomId = null) {
            let content = '';
            const buttons = [];

            switch(type) {
                case 'createClassroom':
                    content = `
                        <div class="form">
                            <div class="form-group">
                                <label>Classroom Name</label>
                                <input type="text" id="className" placeholder="e.g., Class 10-A Mathematics">
                            </div>
                            <div class="form-group">
                                <label>Subject</label>
                                <input type="text" id="subject" placeholder="e.g., Mathematics">
                            </div>
                            <div class="form-group">
                                <label>Grade/Section</label>
                                <input type="text" id="section" placeholder="e.g., Class 10, Section A">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="description" placeholder="Classroom description"></textarea>
                            </div>
                        </div>
                    `;
                    buttons.push({
                        text: 'Create',
                        className: 'btn-primary',
                        action: 'create_classroom'
                    });
                    break;

                case 'joinClassroom':
                    content = `
                        <div class="form">
                            <div class="form-group">
                                <label>Classroom Join Code</label>
                                <input type="text" id="joinCode" placeholder="e.g., ABC123">
                            </div>
                            <div class="form-group">
                                <label>Your Full Name</label>
                                <input type="text" id="studentName" value="${appState.currentUser.name}">
                            </div>
                            <div class="form-group">
                                <label>Roll Number (Optional)</label>
                                <input type="text" id="rollNumber" placeholder="Your roll number">
                            </div>
                        </div>
                    `;
                    buttons.push({
                        text: 'Join',
                        className: 'btn-primary',
                        action: 'join_classroom'
                    });
                    break;

                case 'createAssignment':
                    content = `
                        <div class="form">
                            <div class="form-group">
                                <label>Assignment Title</label>
                                <input type="text" id="assignTitle" placeholder="Assignment name">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="assignDesc" placeholder="Assignment details"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Due Date</label>
                                <input type="date" id="dueDate">
                            </div>
                            <div class="form-group">
                                <label>Max Score</label>
                                <input type="number" id="maxScore" value="100">
                            </div>
                        </div>
                    `;
                    buttons.push({
                        text: 'Create',
                        className: 'btn-primary',
                        action: 'create_assignment'
                    });
                    break;

                case 'uploadNotes':
                    content = `
                        <div class="form">
                            <div class="form-group">
                                <label>Notes Title</label>
                                <input type="text" id="notesTitle" placeholder="Chapter name or topic">
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="notesDesc" placeholder="What's covered in these notes"></textarea>
                            </div>
                            <div class="form-group">
                                <label>File Upload</label>
                                <input type="file" id="notesFile">
                            </div>
                        </div>
                    `;
                    buttons.push({
                        text: 'Upload',
                        className: 'btn-primary',
                        action: 'upload_notes'
                    });
                    break;

                case 'addTeacher':
                    content = `
                        <div class="form">
                            <div class="form-group">
                                <label>Teacher Email</label>
                                <input type="email" id="teacherEmail" placeholder="teacher@school.com">
                            </div>
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" id="teacherName" placeholder="Teacher's name">
                            </div>
                        </div>
                    `;
                    buttons.push({
                        text: 'Add',
                        className: 'btn-primary',
                        action: 'add_teacher'
                    });
                    break;

                case 'broadcastAlert':
                    content = `
                        <div class="form">
                            <div class="form-group">
                                <label>Alert Message</label>
                                <textarea id="alertMsg" placeholder="Important announcement"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Priority</label>
                                <select id="alertPriority">
                                    <option>Normal</option>
                                    <option>High</option>
                                    <option>Urgent</option>
                                </select>
                            </div>
                        </div>
                    `;
                    buttons.push({
                        text: 'Send',
                        className: 'btn-primary',
                        action: 'send_alert'
                    });
                    break;

                case 'linkChild':
                    content = `
                        <div class="form">
                            <div class="form-group">
                                <label>Child's Email</label>
                                <input type="email" id="childEmail" placeholder="child@school.com">
                            </div>
                            <div class="form-group">
                                <label>Child's Name</label>
                                <input type="text" id="childName" placeholder="Your child's name">
                            </div>
                            <p style="color: var(--neutral-gray); font-size: 13px;">A request will be sent to your child to approve parent access.</p>
                        </div>
                    `;
                    buttons.push({
                        text: 'Send Request',
                        className: 'btn-primary',
                        action: 'link_child'
                    });
                    break;
            }

            const modal = ui.showModal('', content, buttons);
            modal.querySelectorAll('button[data-action]').forEach(btn => {
                btn.addEventListener('action', (e) => {
                    const action = e.detail;
                    if (action === 'create_classroom') createClassroom();
                    else if (action === 'join_classroom') joinClassroom();
                    else if (action === 'create_assignment') createAssignment(classroomId);
                    else if (action === 'upload_notes') uploadNotes(classroomId);
                    else if (action === 'add_teacher') addTeacher();
                    else if (action === 'send_alert') sendAlert();
                    else if (action === 'link_child') linkChild();
                });
            });
        }

        function createClassroom() {
            const name = document.getElementById('className').value.trim();
            const subject = document.getElementById('subject').value.trim();
            const section = document.getElementById('section').value.trim();
            const description = document.getElementById('description').value.trim();

            if (!name || !subject || !section) {
                ui.showNotification('Please fill all required fields', 'error');
                return;
            }

            const classroom = {
                id: utils.generateId(),
                name,
                subject,
                section,
                description,
                teacherId: appState.currentUser.id,
                joinCode: utils.generateCode(),
                students: [],
                notes: [],
                messages: [],
                announcements: [],
                createdAt: utils.getCurrentDateTime(),
            };

            appState.classrooms.push(classroom);
            appState.save();
            ui.showNotification(`Classroom created! Share code: ${classroom.joinCode}`, 'success');
            renderApp();
        }

        function joinClassroom() {
            const joinCode = document.getElementById('joinCode').value.trim().toUpperCase();
            const classroom = appState.classrooms.find(c => c.joinCode === joinCode);

            if (!classroom) {
                ui.showNotification('Invalid join code', 'error');
                return;
            }

            if (classroom.students.includes(appState.currentUser.id)) {
                ui.showNotification('You are already in this classroom', 'warning');
                return;
            }

            classroom.students.push(appState.currentUser.id);
            if (!appState.currentUser.classroomIds) appState.currentUser.classroomIds = [];
            appState.currentUser.classroomIds.push(classroom.id);
            appState.save();
            ui.showNotification(`Joined ${classroom.name}!`, 'success');
            renderApp();
        }

        function createAssignment(classroomId) {
            const title = document.getElementById('assignTitle').value.trim();
            const description = document.getElementById('assignDesc').value.trim();
            const dueDate = document.getElementById('dueDate').value;
            const maxScore = parseInt(document.getElementById('maxScore').value) || 100;

            if (!title || !description || !dueDate) {
                ui.showNotification('Please fill all fields', 'error');
                return;
            }

            const assignment = {
                id: utils.generateId(),
                title,
                description,
                dueDate,
                maxScore,
                classroomId,
                teacherId: appState.currentUser.id,
                createdAt: utils.getCurrentDateTime(),
            };

            appState.assignments.push(assignment);
            appState.save();
            ui.showNotification('Assignment created!', 'success');
            renderApp();
        }

        function uploadNotes(classroomId) {
            const title = document.getElementById('notesTitle').value.trim();
            const description = document.getElementById('notesDesc').value.trim();

            if (!title || !description) {
                ui.showNotification('Please fill all fields', 'error');
                return;
            }

            const classroom = appState.classrooms.find(c => c.id === classroomId);
            if (classroom) {
                if (!classroom.notes) classroom.notes = [];
                classroom.notes.push({
                    id: utils.generateId(),
                    title,
                    description,
                    uploadedAt: utils.getCurrentDateTime(),
                });
                appState.save();
                ui.showNotification('Notes uploaded!', 'success');
                renderApp();
            }
        }

        function addTeacher() {
            const email = document.getElementById('teacherEmail').value.trim();
            const name = document.getElementById('teacherName').value.trim();

            if (!email || !name) {
                ui.showNotification('Please fill all fields', 'error');
                return;
            }

            const teacher = {
                id: utils.generateId(),
                email,
                name,
                role: 'teacher',
            };

            appState.teachers.push(teacher);
            appState.save();
            ui.showNotification(`Teacher ${name} added!`, 'success');
            renderApp();
        }

        function sendAlert() {
            const message = document.getElementById('alertMsg').value.trim();
            const classroomId = sessionStorage.getItem('selectedClassroom');

            if (!message) {
                ui.showNotification('Please enter a message', 'error');
                return;
            }

            const classroom = appState.classrooms.find(c => c.id === classroomId);
            if (classroom) {
                if (!classroom.announcements) classroom.announcements = [];
                classroom.announcements.push({
                    text: message,
                    timestamp: utils.getCurrentDateTime(),
                });
                appState.save();
                ui.showNotification('Alert sent!', 'success');
                renderApp();
            }
        }

        function linkChild() {
            const childEmail = document.getElementById('childEmail').value.trim();
            const childName = document.getElementById('childName').value.trim();

            if (!childEmail || !childName) {
                ui.showNotification('Please fill all fields', 'error');
                return;
            }

            appState.parentAccess.push({
                id: utils.generateId(),
                parentId: appState.currentUser.id,
                childEmail,
                childName,
                status: 'pending',
            });
            appState.save();
            ui.showNotification('Request sent to your child!', 'success');
            renderApp();
        }

        function removeTeacher(teacherId) {
            if (confirm('Are you sure you want to remove this teacher?')) {
                appState.teachers = appState.teachers.filter(t => t.id !== teacherId);
                appState.save();
                ui.showNotification('Teacher removed!', 'success');
                renderApp();
            }
        }

        function saveStudentProfile() {
            appState.userProfiles[appState.currentUser.id] = {
                rollNumber: document.getElementById('profileRoll').value,
                section: document.getElementById('profileSection').value,
                bio: document.getElementById('profileBio').value,
                phone: document.getElementById('profilePhone').value,
                dob: document.getElementById('profileDob').value,
            };
            appState.save();
            ui.showNotification('Profile updated!', 'success');
        }

        function saveTeacherProfile() {
            appState.userProfiles[appState.currentUser.id] = {
                qualification: document.getElementById('profileQual').value,
                subject: document.getElementById('profileSubject').value,
                bio: document.getElementById('profileBio').value,
                phone: document.getElementById('profilePhone').value,
                experience: document.getElementById('profileExp').value,
            };
            appState.save();
            ui.showNotification('Profile updated!', 'success');
        }

        function saveParentProfile() {
            appState.userProfiles[appState.currentUser.id] = {
                relationship: document.getElementById('profileRelation').value,
                phone: document.getElementById('profilePhone').value,
                childName: document.getElementById('profileChildName').value,
            };
            appState.save();
            ui.showNotification('Profile updated!', 'success');
        }

        function saveAdminProfile() {
            appState.userProfiles[appState.currentUser.id] = {
                schoolName: document.getElementById('profileSchool').value,
                phone: document.getElementById('profilePhone').value,
            };
            appState.save();
            ui.showNotification('Profile updated!', 'success');
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                appState.setCurrentScreen('login');
                appState.clear();
                renderApp();
                ui.showNotification('Logged out successfully!', 'success');
            }
        }

        function changePassword() {
            ui.showNotification('Password change feature coming soon!', 'warning');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function viewAssignmentStudent(assignmentId) {
            const assignment = appState.assignments.find(a => a.id === assignmentId);
            if (assignment) {
                const content = `
                    <h3>${assignment.title}</h3>
                    <p>${assignment.description}</p>
                    <p><strong>Due Date:</strong> ${utils.formatDate(assignment.dueDate)}</p>
                    <div style="margin-top: 20px;">
                        <h4>Submit Your Work</h4>
                        <input type="file" id="submissionFile">
                        <button class="btn btn-primary" onclick="submitAssignment('${assignmentId}')">Submit</button>
                    </div>
                `;
                const modal = ui.showModal('Submit Assignment', content);
            }
        }

        function submitAssignment(assignmentId) {
            if (!appState.currentUser.submittedAssignments) {
                appState.currentUser.submittedAssignments = [];
            }
            appState.currentUser.submittedAssignments.push(assignmentId);
            appState.save();
            ui.showNotification('Assignment submitted!', 'success');
            renderApp();
        }

        // ===== MAIN RENDER FUNCTION =====
        function renderApp() {
            const app = document.getElementById('app');
            const screen = appState.currentScreen;
            let html = '';

            if (screen === 'login' || screen === 'signup') {
                html = screens[screen]();
            } else if (appState.currentUser) {
                const selectedClassroom = sessionStorage.getItem('selectedClassroom');

                html = `
                    <div class="main-layout">
                        <div class="sidebar">
                            <div class="sidebar-header">
                                <div class="logo">üìö</div>
                                <div>
                                    <div class="title">ClassHub</div>
                                    <div class="subtitle">V2</div>
                                </div>
                            </div>
                            <div class="sidebar-nav" id="sidebarNav">
                                <div class="nav-section">
                                    <div class="nav-section-title">Main</div>
                                    <div class="nav-item ${screen === 'dashboard' ? 'active' : ''}" onclick="appState.setCurrentScreen('dashboard'); sessionStorage.removeItem('selectedClassroom'); renderApp()">
                                        <span class="icon">üè†</span>
                                        <span class="label">Dashboard</span>
                                    </div>
                                    <div class="nav-item" onclick="appState.setCurrentScreen('aichatbot'); renderApp()">
                                        <span class="icon">ü§ñ</span>
                                        <span class="label">Smart Tutor</span>
                                    </div>
                                </div>

                                <div class="nav-section">
                                    <div class="nav-section-title">Profile & Settings</div>
                                    <div class="nav-item" onclick="appState.setCurrentScreen('profile'); renderApp()">
                                        <span class="icon">üë§</span>
                                        <span class="label">My Profile</span>
                                    </div>
                                    <div class="nav-item" onclick="appState.setCurrentScreen('settings'); renderApp()">
                                        <span class="icon">‚öôÔ∏è</span>
                                        <span class="label">Settings</span>
                                    </div>
                                </div>
                            </div>
                            <div class="sidebar-footer">
                                <div class="user-profile-mini">
                                    <div class="avatar">${utils.getInitials(appState.currentUser.name)}</div>
                                    <div class="info">
                                        <div class="name">${appState.currentUser.name}</div>
                                        <div class="email">${appState.currentUser.email}</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="main-content">
                            <div class="top-bar">
                                <div class="top-bar-left">
                                    <div class="page-title">
                                        ${selectedClassroom ? appState.classrooms.find(c => c.id === selectedClassroom)?.name || 'Classroom' : 
                                          screen === 'aichatbot' ? 'ü§ñ Smart Tutor' :
                                          screen === 'profile' ? 'My Profile' :
                                          screen === 'settings' ? 'Settings' :
                                          'Dashboard'}
                                    </div>
                                </div>
                                <div class="top-bar-right">
                                    <div class="search-box">
                                        <span>üîç</span>
                                        <input type="text" placeholder="Search...">
                                    </div>
                                    <button class="icon-button has-notification">üîî</button>
                                    <button class="icon-button" onclick="logout()">üö™</button>
                                </div>
                            </div>

                            <div class="content-area">
                                ${
                                    selectedClassroom ? screens.classroom(selectedClassroom) :
                                    screen === 'aichatbot' ? screens.aiChatbot() :
                                    screen === 'profile' ? (
                                        appState.currentUser.role === 'student' ? screens.studentProfile() :
                                        appState.currentUser.role === 'teacher' ? screens.teacherProfile() :
                                        appState.currentUser.role === 'parent' ? screens.parentProfile() :
                                        screens.adminProfile()
                                    ) :
                                    screen === 'settings' ? screens.settings() :
                                    screens.dashboard()
                                }
                            </div>
                        </div>
                    </div>
                `;

                // Add click handlers for role selection
                setTimeout(() => {
                    document.querySelectorAll('.role-option').forEach(opt => {
                        opt.addEventListener('click', function() {
                            document.querySelectorAll('.role-option').forEach(o => o.classList.remove('selected'));
                            this.classList.add('selected');
                        });
                    });
                }, 100);
            } else {
                html = screens.login();
            }

            app.innerHTML = html;

            // Attach event listeners after DOM update
            setTimeout(() => {
                document.querySelectorAll('.role-option').forEach(opt => {
                    opt.addEventListener('click', function() {
                        document.querySelectorAll('.role-option').forEach(o => o.classList.remove('selected'));
                        this.classList.add('selected');
                    });
                });
            }, 100);
        }

        // Initial render
        renderApp();
    </script>
</body>
</html>
